

-- ==========================  USERS  =====================--

DROP DATABASE IF EXISTS USER_SRVC;
DROP USER IF EXISTS 'USER_SRVC_TEST'@'localhost';

CREATE USER 'USER_SRVC_TEST'@'localhost' IDENTIFIED BY 'iabus9bie9eeZ8wein2ohfaequien';

SYSTEM mysql -u USER_SRVC_TEST -piabus9bie9eeZ8wein2ohfaequien

CREATE DATABASE USER_SRVC;

GRANT ALL PRIVILEGES ON USER_SRVC.* TO 'USER_SRVC_TEST'@'localhost';

USE USER_SRVC;

-- ==========================  SEQUENCES  =====================--

-- CALL CreateSequence('USER_ID_SEQ', 1050, 1);
-- CALL CreateSequence('REMARK_ID_SEQ', 1250, 1);
-- CALL CreateSequence('PHOTO_ID_SEQ', 13350, 1);

-- ==========================  TABLES  =====================--

CREATE TABLE UUSER_ABS (
  ID BIGINT(20) PRIMARY KEY AUTO_INCREMENT,
  FULL_NAME VARCHAR(64),
  EMAIL VARCHAR(128) UNIQUE,
  USER_TOKEN VARCHAR(64),
  PASSWORD VARCHAR(128),
  PERMISSION_ID BIGINT(20) DEFAULT 1,
  DTYPE VARCHAR(8) DEFAULT 'UUser'
);

CREATE TABLE PERMISSION (
  ID BIGINT(20) PRIMARY KEY AUTO_INCREMENT,
  USER_ID BIGINT(20),
  APP_USER_ID BIGINT(20),
  REF_TYPE VARCHAR(32),
  REF_ID BIGINT(20),
  TYPE VARCHAR(32),
  ORIGIN_USER_ID BIGINT(20),
  GRANTED_FROM_USER_ID BIGINT(20),
  CONSTRAINT FK_PERMISSION_USER FOREIGN KEY (USER_ID) REFERENCES UUSER_ABS(ID),
  CONSTRAINT FK_PERMISSION_ORIGIN FOREIGN KEY (ORIGIN_USER_ID) REFERENCES UUSER_ABS(ID),
  CONSTRAINT FK_PERMISSION_GRANTED FOREIGN KEY (GRANTED_FROM_USER_ID) REFERENCES UUSER_ABS(ID)
);

CREATE TABLE USER_PHOTO (
  ID BIGINT(20) PRIMARY KEY AUTO_INCREMENT,
  USER_ID BIGINT(20),
  APP_USER_ID BIGINT(20),
  POSITION TINYINT,
  URL VARCHAR(256),
  CONSTRAINT FK_USER_PHOTO FOREIGN KEY (USER_ID) REFERENCES UUSER_ABS(ID)
);


CREATE TABLE REMARK(
  ID BIGINT(20) PRIMARY KEY,
  POSTER_ID BIGINT(20),
  CONVERSATION_ID BIGINT(20),
  CONTENT LONGTEXT,
  TIME_STAMP DATETIME(6),
  CONSTRAINT FK_POSTER_REMARK FOREIGN KEY (POSTER_ID) REFERENCES UUSER_ABS(ID)
);

CREATE TABLE HAS_READ(
  REMARK_ID BIGINT(20),
  USER_ID BIGINT(20),
  CONSTRAINT FK_REMARK_HAS_READ FOREIGN KEY (REMARK_ID) REFERENCES REMARK(ID),
  CONSTRAINT FK_USER_HAS_READ FOREIGN KEY (USER_ID) REFERENCES UUSER_ABS(ID),
  CONSTRAINT COMP_PK_HAS_READ PRIMARY KEY (REMARK_ID, USER_ID)
);

CREATE TABLE COLLAPSE_USER(
  FOR_USER_ID BIGINT(20),
  TARGET_USER_ID BIGINT(20),
  CONSTRAINT FK_FOR_USER FOREIGN KEY (FOR_USER_ID) REFERENCES UUSER_ABS(ID),
  CONSTRAINT FK_TARGET_USER FOREIGN KEY (TARGET_USER_ID) REFERENCES UUSER_ABS(ID),
  CONSTRAINT COMP_PK_COLLAPSE_USER PRIMARY KEY (FOR_USER_ID, TARGET_USER_ID)
);

-- ==========================  JUnit Test Data  =====================--
INSERT INTO UUSER_ABS (ID,FULL_NAME,EMAIL,PASSWORD,USER_TOKEN) VALUES (-1,'ADMIN','jozsef.morrissey@yahoo.com', '$2a$10$z8aWZRFkRjPkg4dmC6.jfeWKmFslrY95tN8RgdHy0JtSCXZhQnf4e','[B@d077e31');

INSERT INTO UUSER_ABS (ID,FULL_NAME,EMAIL,PASSWORD,USER_TOKEN) VALUES (1,'Jozsef Morrissey','jozsef.morrissey@gmail.com', '$2a$10$z8aWZRFkRjPkg4dmC6.jfeWKmFslrY95tN8RgdHy0JtSCXZhQnf4e','[B@d077e31');
INSERT INTO UUSER_ABS (ID,FULL_NAME,EMAIL,PASSWORD,USER_TOKEN) VALUES (2,'Jerad Morrissey','red3091@gmail.com','$2a$10$z8aWZRFkRjPkg4dmC6.jfeWKmFslrY95tN8RgdHy0JtSCXZhQnf4e','[B@d077e31');
INSERT INTO UUSER_ABS (USER_TOKEN,ID,FULL_NAME,EMAIL,PASSWORD) VALUES ('[B@d077e31',3,'Susan Bernard','in@imperdiet.com','Cras');
INSERT INTO UUSER_ABS (USER_TOKEN,ID,FULL_NAME,EMAIL,PASSWORD) VALUES ('[B@d077e31',4,'Calvin Singleton','gravida.mauris.ut@velitduisemper.org','ultrices. Duis volutpat nunc');
INSERT INTO UUSER_ABS (USER_TOKEN,ID,FULL_NAME,EMAIL,PASSWORD) VALUES ('[B@d077e31',5,'Haviva Hull','egestas.blandit@Ut.co.uk','bibendum. Donec');
INSERT INTO UUSER_ABS (USER_TOKEN,ID,FULL_NAME,EMAIL,PASSWORD) VALUES ('[B@d077e31',6,'Amal Figueroa','In.faucibus@velfaucibus.ca','erat volutpat. Nulla');
INSERT INTO UUSER_ABS (USER_TOKEN,ID,FULL_NAME,EMAIL,PASSWORD) VALUES ('[B@d077e31',7,'Sade Reid','Pellentesque.ultricies.dignissim@ategestas.co.uk','ac');
INSERT INTO UUSER_ABS (USER_TOKEN,ID,FULL_NAME,EMAIL,PASSWORD) VALUES ('[B@d077e31',8,'Jared Estrada','convallis.ligula.Donec@estarcuac.org','est arcu ac');
INSERT INTO UUSER_ABS (USER_TOKEN,ID,FULL_NAME,EMAIL,PASSWORD) VALUES ('[B@d077e31',9,'Lana Abbott','posuere@enim.edu','malesuada id,erat. Etiam');
INSERT INTO UUSER_ABS (USER_TOKEN,ID,FULL_NAME,EMAIL,PASSWORD) VALUES ('[B@d077e31',10,'Edan Chavez','dapibus@in.net','mauris');
INSERT INTO UUSER_ABS (USER_TOKEN,ID,FULL_NAME,EMAIL,PASSWORD) VALUES ('[B@d077e31',11,'Fletcher Crosby','nunc.sed.libero@elementumlorem.net','erat. Vivamus nisi.');
INSERT INTO UUSER_ABS (USER_TOKEN,ID,FULL_NAME,EMAIL,PASSWORD) VALUES ('[B@d077e31',12,'Adrian Goodman','dictum.Phasellus@consectetuermauris.org','ipsum nunc id');
INSERT INTO UUSER_ABS (USER_TOKEN,ID,FULL_NAME,EMAIL,PASSWORD) VALUES ('[B@d077e31',13,'Sean Alston','Nam.porttitor.scelerisque@Utsagittislobortis.net','Pellentesque tincidunt');
INSERT INTO UUSER_ABS (USER_TOKEN,ID,FULL_NAME,EMAIL,PASSWORD) VALUES ('[B@d077e31',14,'Emerald Horn','nibh.enim.gravida@CuraeDonectincidunt.com','sit amet,faucibus ut,');
INSERT INTO UUSER_ABS (USER_TOKEN,ID,FULL_NAME,EMAIL,PASSWORD) VALUES ('[B@d077e31',15,'Reese Jimenez','pellentesque.a@duinec.ca','dolor. Fusce mi lorem,');

INSERT INTO REMARK (ID,POSTER_ID, CONVERSATION_ID, CONTENT, TIME_STAMP) VALUES (1,1,124,'This is the skill that never ends. ',STR_TO_DATE('10-SEP-0214:10:10','%d-%b-%y%T'));
INSERT INTO REMARK (ID,POSTER_ID, CONVERSATION_ID, CONTENT, TIME_STAMP) VALUES (2,1,124,'It goes on and on my friends. ',STR_TO_DATE('10-SEP-0214:33:10','%d-%b-%y%T'));
INSERT INTO REMARK (ID,POSTER_ID, CONVERSATION_ID, CONTENT, TIME_STAMP) VALUES (3,1,124,'some people started concatinating not knowing what it was ',STR_TO_DATE('10-SEP-0214:14:13','%d-%b-%y%T'));
INSERT INTO REMARK (ID,POSTER_ID, CONVERSATION_ID, CONTENT, TIME_STAMP) VALUES (4,1,124,'and they just kept concatinating forever just because',STR_TO_DATE('10-SEP-0214:10:12','%d-%b-%y%T'));

INSERT INTO REMARK (ID,POSTER_ID, CONVERSATION_ID, CONTENT, TIME_STAMP) VALUES (5,2,124,'In all seriousness ',STR_TO_DATE('10-SEP-0214:10:10','%d-%b-%y%T'));
INSERT INTO REMARK (ID,POSTER_ID, CONVERSATION_ID, CONTENT, TIME_STAMP) VALUES (6,2,124,'I think this is a powerful tool that is worth the trouble. ',STR_TO_DATE('10-SEP-0214:10:14','%d-%b-%y%T'));
INSERT INTO REMARK (ID,POSTER_ID, CONVERSATION_ID, CONTENT, TIME_STAMP) VALUES (7,2,124,'Now users can provide as much or as little information as they want. ',STR_TO_DATE('10-SEP-0214:16:10','%d-%b-%y%T'));
INSERT INTO REMARK (ID,POSTER_ID, CONVERSATION_ID, CONTENT, TIME_STAMP) VALUES (8,2,124,'Without harsh memory costs to the system... Enjoy!',STR_TO_DATE('10-SEP-0214:15:10','%d-%b-%y%T'));

INSERT INTO PERMISSION (ID, USER_ID, REF_TYPE, REF_ID, TYPE, ORIGIN_USER_ID) VALUES (-1, -1, '__admin__', -1, 'oao', null);
INSERT INTO PERMISSION (ID, USER_ID, REF_TYPE, REF_ID, TYPE, ORIGIN_USER_ID, APP_USER_ID) VALUES (1, 2, 'object', 3, 'oao', null,1);
INSERT INTO PERMISSION (ID, USER_ID, REF_TYPE, REF_ID, TYPE, ORIGIN_USER_ID, APP_USER_ID) VALUES (2, 4, 'object', 3, 'psuedo', null,1);
INSERT INTO PERMISSION (ID, USER_ID, REF_TYPE, REF_ID, TYPE, ORIGIN_USER_ID, APP_USER_ID) VALUES (3, 7, 'object', 3, 'validation', 4,1);
